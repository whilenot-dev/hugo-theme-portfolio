import{l as e,f as t,W as n,s,i as a,h as i,j as o,k as c}from"./main.js";let r=[],d={x:0,y:0};const g=new n([]),l=new n(!1),u=new n(!1),h=new n(!1),m=new n(!1);let v,f,p=!1;function y(){return g.get().map((e=>r[e.i]))}function w(){const e=y().slice(-s.get().trailLength);return e.slice(0,e.length-1)}function E(){const e=y();return e[e.length-1]}function I(){const e=g.get(),t=s.get(),n=e.length>0?e[e.length-1].i:t.index,i=[];for(let e=0;e<7;e++)i.push(r[a(n+e,t.length)]);return i}function L(){const e=g.get(),t=s.get();return r[o(e[e.length-1].i,t.length)]}function x(){const e=g.get(),t=s.get();return r[a(e[e.length-1].i,t.length)]}function W(e){if(l.get()||u.get()||!p)return;const t={x:e.clientX,y:e.clientY};if(Math.hypot(t.x-d.x,t.y-d.y)>s.get().threshold){d=t,i();const e={i:s.get().index,...t};g.set([...g.get(),e].slice(-s.get().length))}}function k(){if(u.get()||!p)return;l.set(!0),u.set(!0);const e=E();A([e,L(),x()]),b(e);const t=v.timeline();t.to(w(),{y:"+=20",ease:f.easeIn,stagger:.075,duration:.3,delay:.1,opacity:0}),t.to(E(),{x:0,y:0,ease:f.easeInOut,duration:.7,delay:.3}),t.to(E(),{delay:.1,scale:1,ease:f.easeInOut}),t.then((()=>{u.set(!1)})).catch((e=>{console.log(e)}))}function H(){if(u.get()||!p)return;l.set(!1),u.set(!0),N([E()]),N(w());const e=v.timeline();e.to(E(),{scale:.6,duration:.6,ease:f.easeInOut}),e.to(E(),{delay:.3,duration:.7,ease:f.easeInOut,x:g.get()[g.get().length-1].x-window.innerWidth/2,y:g.get()[g.get().length-1].y-window.innerHeight/2}),e.to(w(),{y:"-=20",ease:f.easeOut,stagger:-.1,duration:.3,opacity:1}),e.then((()=>{u.set(!1)})).catch((e=>{console.log(e)}))}function A(e){e.forEach((e=>{e.src=e.dataset.hiUrl,e.height=parseInt(e.dataset.hiImgH),e.width=parseInt(e.dataset.hiImgW)}))}function N(e){e.forEach((e=>{e.src=e.dataset.loUrl,e.height=parseInt(e.dataset.loImgH),e.width=parseInt(e.dataset.loImgW)}))}function b(e){e.complete?(e.classList.remove("hide"),m.set(!1)):(m.set(!0),e.addEventListener("load",(()=>{m.set(!1),e.classList.remove("hide")}),{once:!0,passive:!0}),e.addEventListener("error",(()=>{m.set(!1)}),{once:!0,passive:!0}))}const O=document.createElement("div"),T=document.createElement("div");function U(e){const t=e.clientX,n=e.clientY;O.style.transform=`translate3d(${t}px, ${n}px, 0)`}function S(e){T.innerText=e}const B=document.getElementById("main"),j=[B.getAttribute("prevText"),B.getAttribute("closeText"),B.getAttribute("nextText")],X=B.getAttribute("loadingText")+"...";let Y="";function $(e){e===j[0]?M():e===j[1]?H():C()}function z(e){if(!l.get()&&!u.get())switch(e.key){case"ArrowLeft":M();break;case"Escape":H();break;case"ArrowRight":C()}}function C(){u.get()||(g.set(g.get().map((e=>({...e,i:a(e.i,s.get().length)})))),i())}function M(){u.get()||(g.set(g.get().map((e=>({...e,i:o(e.i,s.get().length)})))),c())}function R(e){$(e),m.set(!1)}function q(e){Y=e,S(e)}function D(e){m.get()||$(e)}function F(e){Y=e,m.get()?S(X):S(e)}function G(n){O.className="cursor",T.className="cursorInner",O.append(T),t.append(O),window.addEventListener("mousemove",U,{passive:!0}),h.addWatcher((e=>{e?O.classList.add("active"):O.classList.remove("active")})),function(n){!function(e){const n=document.createElement("div");n.className="stage";for(const t of e){const e=document.createElement("img");e.height=t.loImgH,e.width=t.loImgW,e.dataset.hiUrl=t.hiUrl,e.dataset.hiImgH=t.hiImgH.toString(),e.dataset.hiImgW=t.hiImgW.toString(),e.dataset.loUrl=t.loUrl,e.dataset.loImgH=t.loImgH.toString(),e.dataset.loImgW=t.loImgW.toString(),e.alt=t.alt,n.append(e)}t.append(n)}(n);const a=document.getElementsByClassName("stage").item(0);r=Array.from(a.getElementsByTagName("img")),a.addEventListener("click",(()=>{k()})),a.addEventListener("keydown",(()=>{k()})),window.addEventListener("mousemove",W,{passive:!0}),l.addWatcher((e=>{h.set(e&&!u.get())})),u.addWatcher((e=>{h.set(l.get()&&!e)})),g.addWatcher((e=>{!function(){const e=y();if(0!==e.length&&p&&(N(I()),v.set(e,{x:e=>g.get()[e].x-window.innerWidth/2,y:e=>g.get()[e].y-window.innerHeight/2,opacity:e=>e+1+s.get().trailLength<=g.get().length?0:1,zIndex:e=>e,scale:.6}),l.get())){N(y());const e=E();e.src="",e.classList.add("hide"),A([e,L(),x()]),v.set(r,{opacity:0}),v.set(e,{opacity:1,x:0,y:0,scale:1}),b(e)}}()})),N(I()),window.addEventListener("mousemove",(()=>{e().then((e=>{v=e[0],f=e[1],p=!0})).catch((e=>{console.log(e)}))}),{once:!0,passive:!0})}(n),function(){m.addWatcher((e=>{S(e?X:Y)}));const e=document.createElement("div");e.className="navOverlay";for(const[t,n]of j.entries()){const s=document.createElement("div");s.className="overlay",1===t?(s.addEventListener("click",(()=>{R(n)}),{passive:!0}),s.addEventListener("keydown",(()=>{R(n)}),{passive:!0}),s.addEventListener("mouseover",(()=>{q(n)}),{passive:!0}),s.addEventListener("focus",(()=>{q(n)}),{passive:!0})):(s.addEventListener("click",(()=>{D(n)}),{passive:!0}),s.addEventListener("keydown",(()=>{D(n)}),{passive:!0}),s.addEventListener("mouseover",(()=>{F(n)}),{passive:!0}),s.addEventListener("focus",(()=>{F(n)}),{passive:!0})),e.append(s)}h.addWatcher((()=>{h.get()?e.classList.add("active"):e.classList.remove("active")})),t.append(e),window.addEventListener("keydown",z,{passive:!0})}()}export{G as initDesktop};